# RE Profile - Reverse Engineering & Exploit Development
# Based on: offsec-toolbox
FROM containers-storage:localhost/offsec-toolbox:0.1.0

# Switch to root for package installation
USER root

# Install RE-specific packages
COPY manifests/re-packages.txt /tmp/re-packages.txt
RUN pacman -Sy --noconfirm --needed --overwrite='*' \
    $(grep -vE '^\s*(#|$)' /tmp/re-packages.txt) && \
    ldconfig && \
    pacman -Scc --noconfirm

# Install Python tools (pwntools, ROPgadget, etc.)
RUN pip install --break-system-packages --no-cache-dir \
    pwntools \
    ROPgadget \
    capstone \
    unicorn

# Install one_gadget (ROP helper)
RUN gem install one_gadget --no-document

# Clean up
RUN rm -f /tmp/re-packages.txt

# Switch back to operator
USER operator
WORKDIR /home/operator

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD gdb --version && python3 -c "import pwn" || exit 1

# Default command
CMD ["/bin/bash"]
