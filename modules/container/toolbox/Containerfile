# offsec-toolbox (minimal)
# Build with: modules/container/scripts/toolbox-build.sh
FROM archlinux:base

# Keep pacman predictable + non-interactive inside builds
RUN sed -i 's/^#Color/Color/' /etc/pacman.conf && \
    sed -i 's/^#ParallelDownloads/ParallelDownloads/' /etc/pacman.conf && \
    printf '\n[options]\nILoveCandy\n' >> /etc/pacman.conf || true

# Install from repo-owned package list (tight + auditable)
COPY packages.txt /tmp/packages.txt

RUN pacman -Sy --noconfirm --needed archlinux-keyring && \
    pacman -S --noconfirm --needed $(grep -vE '^\s*#|^\s*$' /tmp/packages.txt) && \
    pacman -Scc --noconfirm && \
    rm -f /tmp/packages.txt

# Non-root runtime user (rootless-friendly)
RUN useradd -m -s /bin/bash operator && \
    touch /home/operator/.bashrc && \
    chown -R operator:operator /home/operator

# Set default shell explicitly and avoid hardcoding TERM
USER operator
WORKDIR /work
SHELL ["/bin/bash", "-l"]

# Default command: interactive shell
CMD ["bash", "-l"]

